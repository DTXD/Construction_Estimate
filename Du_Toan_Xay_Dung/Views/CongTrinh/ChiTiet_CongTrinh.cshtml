@using Du_Toan_Xay_Dung.Models
@{
    var CongTrinhs = ViewData["List_CongTrinh"] as List<BuildingViewModel>;
    var congtrinh = ViewData["CongTrinh_Detail"] as BuildingViewModel;
    var HangMucs_IdCT = ViewData["List_HangMuc_IdCT"] as List<HangMucViewModel>;
    ViewBag.Title = "ChiTiet_CongTrinh";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script>
    angular.module('postApp', [])
     .controller('postController', ['$scope', '$http','$filter', function ($scope, $http, $filter) {
         //load list hangmuc
         $scope.list_hangmuc = [];
         $http.get('/CongTrinh/Get_AllHangMuc').then(function (response) {
             $scope.list_hangmuc = response.data;
         }, function (response) {
             //Showing errors
         });

         //array did filter
         $scope.items = [];
         $scope.change_select = function (value) {
             $scope.items = $filter('filter')($scope.list_hangmuc, value);
         };


         //delete hang muc
         $scope.itemList = [];
         $scope.submitForm = function () {
             var hoi = confirm("Bạn có chắc chắn muốn xóa hạng mục này");
             if (hoi == true) {
                 if ($scope.formAdd.$valid) {
                     var mahm = document.getElementById("mahm").value;
                     var mact = document.getElementById("mact").value;
                     console.log(mahm);
                     var postdata = {
                         ID: mahm,
                         Building_ID: mact
                     };
                     $http({
                         method: 'POST',
                         url: '/CongTrinh/Delete_HangMuc',
                         data: JSON.stringify(postdata),
                         headers: { 'Content-Type': 'application/json' }
                     })
                         .success(function (result) {
                             if (result == "ok") {
                                 alert("Xóa thành công");
                                 window.location.href = "/CongTrinh/ChiTiet_CongTrinh/@congtrinh.ID";
                             }
                             else {
                                 alert("Xảy ra lỗi");
                             }


                         });
                 }
             }
         };

     }]);
</script>
<section class="content-header">
    <ol class="breadcrumb">
        <li><a href="/CongTrinh/Index"><i class="fa fa-dashboard"></i>Công Trình</a></li>
        <li class="active">Hạng Mục</li>
    </ol>
</section>

<section class="content" ng-app="postApp" ng-controller="postController">
    <select ng-model="hangmucfilter" ng-change="change_select(hangmucfilter)" class="selectpicker" data-width="200px">
        @if(CongTrinhs!=null && HangMucs_IdCT.Count!=0)
        { 
        foreach (var item in CongTrinhs)
        {
            if (item.ID.Equals(HangMucs_IdCT.First().Building_ID))
            {
                <option value="@item.ID" selected>@item.Name</option>
            }
            else
            {
                <option value="@item.ID">@item.Name</option>
            }
        }
        }
    </select>
    <br /><br />
    <div class="col-lg-12">
        <a class="btn btn-primary" id="btn_themhm" href="/CongTrinh/ThemHangMuc/@congtrinh.ID"><i class="fa fa-fw fa-plus"></i>Thêm Hạng Mục</a>
    </div>
    <div id="container" class="container" style="margin-top:100px">
        <form method="post" name="formAdd" id="formAdd" ng-submit="submitForm()">
            <div class="box">
                <div class="box-header">
                    <h3 class="box-title">Hạng Mục</h3>
                </div><!-- /.box-header -->
                <div class="box-body no-padding">
                    <table class="table table-condensed">
                        <tbody>
                            <tr>
                                <th style="width: 50px">#</th>
                                <th style="width: 250px">Tên</th>
                                <th style="width: 250px">Mô Tả</th>
                                <th style="width: 80px">Giá</th>
                                <th colspan="3"></th>
                            </tr>
                            <tr ng-repeat="data in items">
                                <td></td>
                                <td>{{data.Name}}</td>
                                <td>{{data.Description}}</td>
                                <td>{{data.Sum}}</td>
                                <td>
                                    <a class="btn btn-primary btn-flat btn-xs" title="Hạng Mục" href="/CongTrinh/UpdateHangMuc/?ID={{data.ID}}" target="_blank">
                                        <i class="fa fa-edit"></i>Sửa
                                    </a>
                                </td>
                                <td>
                                    <a class="btn btn-primary btn-flat btn-xs" title="Hạng Mục" href="/HangMuc/Index/?ID={{data.ID}}" target="_blank">
                                        <i class="fa fa-edit"></i>Dự Toán
                                    </a>
                                </td>
                                <td>
                                    <input type="hidden" name="mahm" id="mahm" ng-model="hangmuc.ID" value="{{data.ID}}" />
                                    <input type="hidden" name="mact" id="mact" value="{{data.Building_ID}}" />
                                    <button type="submit" class="btn btn-danger btn-flat btn-xs">
                                        <i class="fa fa-edit">
                                            Xóa
                                        </i>
                                    </button>
                                </td>
                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>
        </form>
    </div>
    <!-- /.box-body -->
</section>

